<!--
SPDX-FileCopyrightText: 2021 smdn <smdn@smdn.jp>
SPDX-License-Identifier: MIT
-->
<Project>
  <!-- *_OR_GREATER are defined in AddImplicitDefineConstants of Microsoft.NET.Sdk.BeforeCommon.targets -->
  <Target
    Name="AddNETSdkApiDefineConstants"
    DependsOnTargets="AddImplicitDefineConstants"
    BeforeTargets="CoreCompile"
  >
    <!-- NET46_OR_GREATER || NETSTANDARD1_3_OR_GREATER || NETCOREAPP1_0_OR_GREATER || NET5_0_OR_GREATER -->
    <ItemGroup Condition="
      $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNET46_OR_GREATER\b')) Or
      $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNETSTANDARD1_3_OR_GREATER\b')) Or
      $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNETCOREAPP1_0_OR_GREATER\b')) Or
      $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNET5_0_OR_GREATER\b'))
    ">
      <_NETSdkApiDefineConstant Include="System.Array.Empty"/>
      <_NETSdkApiDefineConstant Include="System.FormattableString"/>
      <_NETSdkApiDefineConstant Include="System.Threading.Tasks.Task.CompletedTask"/>
      <_NETSdkApiDefineConstant Include="System.Threading.Tasks.Task.FromCanceled"/>
    </ItemGroup>

    <!-- NETFRAMEWORK || NETSTANDARD2_0_OR_GREATER || NETCOREAPP2_0_OR_GREATER || NET5_0_OR_GREATER -->
    <ItemGroup Condition="
      $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNETFRAMEWORK\b')) Or
      $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNETSTANDARD2_0_OR_GREATER\b')) Or
      $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNETCOREAPP2_0_OR_GREATER\b')) Or
      $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNET5_0_OR_GREATER\b'))
    ">
      <_NETSdkApiDefineConstant Include="System.Array.ConvertAll"/>
      <_NETSdkApiDefineConstant Include="System.Converter"/>
      <_NETSdkApiDefineConstant Include="System.Exception.ctor(SerializationInfo)"/>
      <_NETSdkApiDefineConstant Include="System.ICloneable"/>
      <_NETSdkApiDefineConstant Include="System.Math.DivRem"/>
      <_NETSdkApiDefineConstant Include="System.Diagnostics.Process"/>
      <_NETSdkApiDefineConstant Include="System.IO.Stream.Close"/>
      <_NETSdkApiDefineConstant Include="System.Net.NetworkInformation.PhysicalAddress"/>
      <_NETSdkApiDefineConstant Include="System.Security.Cryptography.HashAlgorithm.Clear"/>
    </ItemGroup>

    <!-- NETFRAMEWORK -->
    <ItemGroup Condition="
      $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNETFRAMEWORK\b'))
    ">
      <_NETSdkApiDefineConstant Include="System.Text.Encoding.Default_ANSI"/>
    </ItemGroup>

    <!-- NETSTANDARD2_1_OR_GREATER || NETCOREAPP2_0_OR_GREATER || NET5_0_OR_GREATER -->
    <ItemGroup Condition="
      $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNETSTANDARD2_1_OR_GREATER\b')) Or
      $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNETCOREAPP2_0_OR_GREATER\b')) Or
      $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNET5_0_OR_GREATER\b'))
    ">
      <_NETSdkApiDefineConstant Include="System.ArraySegment.Slice"/>
      <_NETSdkApiDefineConstant Include="System.String.StartsWith(char)"/>
      <_NETSdkApiDefineConstant Include="System.Collections.Generic.KeyValuePair.Create"/>
      <_NETSdkApiDefineConstant Include="System.IO.Path.GetRelativePath"/>
    </ItemGroup>

    <!-- NETSTANDARD2_1_OR_GREATER || NETCOREAPP2_1_OR_GREATER || NET5_0_OR_GREATER -->
    <ItemGroup Condition="
      $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNETSTANDARD2_1_OR_GREATER\b')) Or
      $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNETCOREAPP2_1_OR_GREATER\b')) Or
      $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNET5_0_OR_GREATER\b'))
    ">
      <_NETSdkApiDefineConstant Include="System.String.Create"/>
      <_NETSdkApiDefineConstant Include="System.String.Contains(char)"/>
      <_NETSdkApiDefineConstant Include="System.IO.Stream.ReadAsync(Memory_Of_Byte)"/>
      <_NETSdkApiDefineConstant Include="System.IO.Stream.WriteAsync(ReadOnlyMemory_Of_Byte)"/>
    </ItemGroup>

    <!-- NETSTANDARD2_1_OR_GREATER || NETCOREAPP3_0_OR_GREATER || NET5_0_OR_GREATER -->
    <ItemGroup Condition="
      $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNETSTANDARD2_1_OR_GREATER\b')) Or
      $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNETCOREAPP3_0_OR_GREATER\b')) Or
      $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNET5_0_OR_GREATER\b'))
    ">
      <_NETSdkApiDefineConstant Include="System.Index"/>
      <_NETSdkApiDefineConstant Include="System.Range"/>
    </ItemGroup>

    <!-- NET5_0_OR_GREATER -->
    <ItemGroup Condition="
      $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNET5_0_OR_GREATER\b'))
    ">
      <_NETSdkApiDefineConstant Include="System.Threading.Tasks.ValueTask.FromCanceled"/>
    </ItemGroup>

    <PropertyGroup Condition="0 &lt; @(_NETSdkApiDefineConstant->Count())">
      <DefineConstants>$(DefineConstants);@(_NETSdkApiDefineConstant->ToUpperInvariant()->Replace('.', '_')->Replace('(', '_')->Replace(')', ''), ';')</DefineConstants>
    </PropertyGroup>
  </Target>
</Project>
