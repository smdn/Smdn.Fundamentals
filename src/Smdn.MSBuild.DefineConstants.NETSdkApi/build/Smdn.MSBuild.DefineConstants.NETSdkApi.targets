<!--
SPDX-FileCopyrightText: 2021 smdn <smdn@smdn.jp>
SPDX-License-Identifier: MIT
-->
<Project>
  <!-- *_OR_GREATER are defined in AddImplicitDefineConstants of Microsoft.NET.Sdk.BeforeCommon.targets -->
  <Target
    Name="AddNETSdkApiDefineConstants"
    DependsOnTargets="AddImplicitDefineConstants"
    BeforeTargets="CoreCompile"
  >
    <CallTarget Targets="ListNETSdkAvailableApiName">
      <Output TaskParameter="TargetOutputs" ItemName="_NETSdkAvailableApiSymbol" />
    </CallTarget>

    <!-- <Message Text="@(_NETSdkAvailableApiSymbol, ', ')" Importance="high" /> -->

    <PropertyGroup>
      <DefineConstants>$(DefineConstants);@(_NETSdkAvailableApiSymbol, ';')</DefineConstants>
    </PropertyGroup>
  </Target>

  <!-- call targets defined by $(AddNETSdkApiDefineConstantsBeforeTargets) which are needed to run before AddNETSdkApiDefineConstants -->
  <Target
    Name="_BeforeAddNETSdkApiDefineConstants"
    DependsOnTargets="$(AddNETSdkApiDefineConstantsBeforeTargets)"
    BeforeTargets="AddNETSdkApiDefineConstants"
    Condition="'$(AddNETSdkApiDefineConstantsBeforeTargets)' != ''"
  />

  <!-- call targets defined by $(AddNETSdkApiDefineConstantsAfterTargets) which are needed to run after AddNETSdkApiDefineConstants -->
  <Target
    Name="_AfterAddNETSdkApiDefineConstants"
    DependsOnTargets="$(AddNETSdkApiDefineConstantsAfterTargets)"
    AfterTargets="AddNETSdkApiDefineConstants"
    Condition="'$(AddNETSdkApiDefineConstantsAfterTargets)' != ''"
  />

  <!-- ref: list of preprocessor symbols for .NET target frameworks: https://docs.microsoft.com/ja-jp/dotnet/standard/frameworks -->
  <Target
    Name="ListNETSdkAvailableApiName"
    Returns="@(NETSdkAvailableApiSymbol)"
  >
    <!-- NETFRAMEWORK -->
    <PropertyGroup>
      <_TargetFrameworkCondition>NETFRAMEWORK</_TargetFrameworkCondition>
    </PropertyGroup>

    <MSBuild Properties="Set=$(DefineConstants);OtherSet=$(_TargetFrameworkCondition)" Projects="$(MSBuildThisFileFullPath)" Targets="TestSetOverlapsWith" >
      <Output TaskParameter="TargetOutputs" PropertyName="_IsTargetFrameworkConditionMatched" />
    </MSBuild>

    <ItemGroup Condition="'$(_IsTargetFrameworkConditionMatched)' == 'true'">
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.Text" Include="Encoding.Default_ANSI"/>
    </ItemGroup>

    <!-- NET40_OR_GREATER || NETSTANDARD2_0_OR_GREATER || NETCOREAPP2_0_OR_GREATER || NET5_0_OR_GREATER -->
    <PropertyGroup>
      <_TargetFrameworkCondition>NET40_OR_GREATER;NETSTANDARD2_0_OR_GREATER;NETCOREAPP2_0_OR_GREATER;NET5_0_OR_GREATER</_TargetFrameworkCondition>
    </PropertyGroup>

    <MSBuild Properties="Set=$(DefineConstants);OtherSet=$(_TargetFrameworkCondition)" Projects="$(MSBuildThisFileFullPath)" Targets="TestSetOverlapsWith" >
      <Output TaskParameter="TargetOutputs" PropertyName="_IsTargetFrameworkConditionMatched" />
    </MSBuild>

    <ItemGroup Condition="'$(_IsTargetFrameworkConditionMatched)' == 'true'">
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="Environment.Is64BitProcess"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="Environment.Is64BitOperatingSystem"/>
    </ItemGroup>

    <!-- NET45_OR_GREATER || NETSTANDARD1_1_OR_GREATER || NETCOREAPP1_0_OR_GREATER || NET5_0_OR_GREATER -->
    <PropertyGroup>
      <_TargetFrameworkCondition>NET45_OR_GREATER;NETSTANDARD1_1_OR_GREATER;NETCOREAPP1_0_OR_GREATER;NET5_0_OR_GREATER</_TargetFrameworkCondition>
    </PropertyGroup>

    <MSBuild Properties="Set=$(DefineConstants);OtherSet=$(_TargetFrameworkCondition)" Projects="$(MSBuildThisFileFullPath)" Targets="TestSetOverlapsWith" >
      <Output TaskParameter="TargetOutputs" PropertyName="_IsTargetFrameworkConditionMatched" />
    </MSBuild>

    <ItemGroup Condition="'$(_IsTargetFrameworkConditionMatched)' == 'true'">
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.Runtime.InteropServices" Include="MemoryMarshal"/>
    </ItemGroup>

    <!-- NET46_OR_GREATER || NETSTANDARD1_3_OR_GREATER || NETCOREAPP1_0_OR_GREATER || NET5_0_OR_GREATER -->
    <PropertyGroup>
      <_TargetFrameworkCondition>NET46_OR_GREATER;NETSTANDARD1_3_OR_GREATER;NETCOREAPP1_0_OR_GREATER;NET5_0_OR_GREATER</_TargetFrameworkCondition>
    </PropertyGroup>

    <MSBuild Properties="Set=$(DefineConstants);OtherSet=$(_TargetFrameworkCondition)" Projects="$(MSBuildThisFileFullPath)" Targets="TestSetOverlapsWith" >
      <Output TaskParameter="TargetOutputs" PropertyName="_IsTargetFrameworkConditionMatched" />
    </MSBuild>

    <ItemGroup Condition="'$(_IsTargetFrameworkConditionMatched)' == 'true'">
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="Array.Empty"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="FormattableString"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.Threading.Tasks" Include="Task.CompletedTask"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.Threading.Tasks" Include="Task.FromCanceled"/>
    </ItemGroup>

    <!-- NET461_OR_GREATER || NETSTANDARD2_0_OR_GREATER || NETCOREAPP2_0_OR_GREATER || NET5_0_OR_GREATER -->
    <PropertyGroup>
      <_TargetFrameworkCondition>NET461_OR_GREATER;NETSTANDARD2_0_OR_GREATER;NETCOREAPP2_0_OR_GREATER;NET5_0_OR_GREATER</_TargetFrameworkCondition>
    </PropertyGroup>

    <MSBuild Properties="Set=$(DefineConstants);OtherSet=$(_TargetFrameworkCondition)" Projects="$(MSBuildThisFileFullPath)" Targets="TestSetOverlapsWith" >
      <Output TaskParameter="TargetOutputs" PropertyName="_IsTargetFrameworkConditionMatched" />
    </MSBuild>

    <ItemGroup Condition="'$(_IsTargetFrameworkConditionMatched)' == 'true'">
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="HashCode"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="IAsyncDisposable"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.Runtime.CompilerServices" Include="Unsafe"/>
    </ItemGroup>

    <!-- NETFRAMEWORK || NETSTANDARD2_0_OR_GREATER || NETCOREAPP2_0_OR_GREATER || NET5_0_OR_GREATER -->
    <PropertyGroup>
      <_TargetFrameworkCondition>NETFRAMEWORK;NETSTANDARD2_0_OR_GREATER;NETCOREAPP2_0_OR_GREATER;NET5_0_OR_GREATER</_TargetFrameworkCondition>
    </PropertyGroup>

    <MSBuild Properties="Set=$(DefineConstants);OtherSet=$(_TargetFrameworkCondition)" Projects="$(MSBuildThisFileFullPath)" Targets="TestSetOverlapsWith" >
      <Output TaskParameter="TargetOutputs" PropertyName="_IsTargetFrameworkConditionMatched" />
    </MSBuild>

    <ItemGroup Condition="'$(_IsTargetFrameworkConditionMatched)' == 'true'">
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="Array.ConvertAll"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="Converter"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="Environment.Version"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="Exception.ctor(SerializationInfo)"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="ICloneable"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="Math.DivRem"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="Uri.UriSchemeFile"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="Uri.UriSchemeHttp"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="Uri.UriSchemeHttps"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="Uri.UriSchemeMailto"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.Diagnostics" Include="Process"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.IO" Include="Stream.Close"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.Net.NetworkInformation" Include="PhysicalAddress"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.Runtime.Serialization.Formatter.Binary" Include="%2A"/> <!-- '*' -->
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.Runtime.Serialization" Include="SerializationBinder"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.Security.Cryptography" Include="HashAlgorithm.Clear"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.Text" Include="Encoding.BodyName"/>
    </ItemGroup>

    <!-- NET472_OR_GREATER || NETSTANDARD2_1_OR_GREATER || NETCOREAPP2_0_OR_GREATER || NET5_0_OR_GREATER -->
    <PropertyGroup>
      <_TargetFrameworkCondition>NET472_OR_GREATER;NETSTANDARD2_1_OR_GREATER;NETCOREAPP2_0_OR_GREATER;NET5_0_OR_GREATER</_TargetFrameworkCondition>
    </PropertyGroup>

    <MSBuild Properties="Set=$(DefineConstants);OtherSet=$(_TargetFrameworkCondition)" Projects="$(MSBuildThisFileFullPath)" Targets="TestSetOverlapsWith" >
      <Output TaskParameter="TargetOutputs" PropertyName="_IsTargetFrameworkConditionMatched" />
    </MSBuild>

    <ItemGroup Condition="'$(_IsTargetFrameworkConditionMatched)' == 'true'">
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.Security.Cryptography" Include="CryptoStream.ctor(leaveOpen)"/>
    </ItemGroup>

    <!-- NETSTANDARD2_1_OR_GREATER || NETCOREAPP2_0_OR_GREATER || NET5_0_OR_GREATER -->
    <PropertyGroup>
      <_TargetFrameworkCondition>NETSTANDARD2_1_OR_GREATER;NETCOREAPP2_0_OR_GREATER;NET5_0_OR_GREATER</_TargetFrameworkCondition>
    </PropertyGroup>

    <MSBuild Properties="Set=$(DefineConstants);OtherSet=$(_TargetFrameworkCondition)" Projects="$(MSBuildThisFileFullPath)" Targets="TestSetOverlapsWith" >
      <Output TaskParameter="TargetOutputs" PropertyName="_IsTargetFrameworkConditionMatched" />
    </MSBuild>

    <ItemGroup Condition="'$(_IsTargetFrameworkConditionMatched)' == 'true'">
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="ArraySegment.Slice"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="String.EndsWith(char)"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="String.Split(char)"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="String.Split(string)"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="String.StartsWith(char)"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.Collections.Generic" Include="KeyValuePair.Create"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.IO" Include="Path.GetRelativePath"/>
    </ItemGroup>

    <!-- NETSTANDARD2_1_OR_GREATER || NETCOREAPP2_1_OR_GREATER || NET5_0_OR_GREATER -->
    <PropertyGroup>
      <_TargetFrameworkCondition>NETSTANDARD2_1_OR_GREATER;NETCOREAPP2_1_OR_GREATER;NET5_0_OR_GREATER</_TargetFrameworkCondition>
    </PropertyGroup>

    <MSBuild Properties="Set=$(DefineConstants);OtherSet=$(_TargetFrameworkCondition)" Projects="$(MSBuildThisFileFullPath)" Targets="TestSetOverlapsWith" >
      <Output TaskParameter="TargetOutputs" PropertyName="_IsTargetFrameworkConditionMatched" />
    </MSBuild>

    <ItemGroup Condition="'$(_IsTargetFrameworkConditionMatched)' == 'true'">
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="INumber.Parse(ReadOnlySpan&lt;Char&gt;)"/> <!-- Int32.Parse(ROS<char>), Double.Parse(ROS<char>), etc. -->
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="INumber.TryParse(ReadOnlySpan&lt;Char&gt;)"/> <!-- Int32.TryParse(ROS<char>), Double.TryParse(ROS<char>), etc. -->
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="Math.Clamp"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="String.ctor(ReadOnlySpan&lt;Char&gt;)"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="String.Create"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="String.Contains(char)"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.IO" Include="Path.Join"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.IO" Include="Path.TryJoin"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.IO" Include="Stream.Read(Span&lt;Byte&gt;)"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.IO" Include="Stream.ReadAsync(Memory&lt;Byte&gt;)"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.IO" Include="Stream.Write(ReadOnlySpan&lt;Byte&gt;)"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.IO" Include="Stream.WriteAsync(ReadOnlyMemory&lt;Byte&gt;)"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.Runtime.InteropServices" Include="MemoryMarshal.CreateReadOnlySpan"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.Text" Include="StringBuilder.Append(ReadOnlySpan&lt;Char&gt;)"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.Threading.Tasks" Include="ValueTask"/>
    </ItemGroup>

    <!-- NETSTANDARD2_1_OR_GREATER || NETCOREAPP3_0_OR_GREATER || NET5_0_OR_GREATER -->
    <PropertyGroup>
      <_TargetFrameworkCondition>NETSTANDARD2_1_OR_GREATER;NETCOREAPP3_0_OR_GREATER;NET5_0_OR_GREATER</_TargetFrameworkCondition>
    </PropertyGroup>

    <MSBuild Properties="Set=$(DefineConstants);OtherSet=$(_TargetFrameworkCondition)" Projects="$(MSBuildThisFileFullPath)" Targets="TestSetOverlapsWith" >
      <Output TaskParameter="TargetOutputs" PropertyName="_IsTargetFrameworkConditionMatched" />
    </MSBuild>

    <ItemGroup Condition="'$(_IsTargetFrameworkConditionMatched)' == 'true'">
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="Index"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="Range"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.Buffers" Include="SequenceReader"/>
    </ItemGroup>

    <!-- NETCOREAPP3_0_OR_GREATER || NET5_0_OR_GREATER -->
    <PropertyGroup>
      <_TargetFrameworkCondition>NETCOREAPP3_0_OR_GREATER;NET5_0_OR_GREATER</_TargetFrameworkCondition>
    </PropertyGroup>

    <MSBuild Properties="Set=$(DefineConstants);OtherSet=$(_TargetFrameworkCondition)" Projects="$(MSBuildThisFileFullPath)" Targets="TestSetOverlapsWith" >
      <Output TaskParameter="TargetOutputs" PropertyName="_IsTargetFrameworkConditionMatched" />
    </MSBuild>

    <ItemGroup Condition="'$(_IsTargetFrameworkConditionMatched)' == 'true'">
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.Numerics" Include="BitOperations.LeadingZeroCount"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.Numerics" Include="BitOperations.Log2"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.Numerics" Include="BitOperations.PopCount"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.Numerics" Include="BitOperations.TrailingZeroCount"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.Text" Include="StringBuilder.Append(ReadOnlyMemory&lt;Char&gt;)"/>
    </ItemGroup>

    <!-- NET5_0_OR_GREATER -->
    <PropertyGroup>
      <_TargetFrameworkCondition>NET5_0_OR_GREATER</_TargetFrameworkCondition>
    </PropertyGroup>

    <MSBuild Properties="Set=$(DefineConstants);OtherSet=$(_TargetFrameworkCondition)" Projects="$(MSBuildThisFileFullPath)" Targets="TestSetOverlapsWith" >
      <Output TaskParameter="TargetOutputs" PropertyName="_IsTargetFrameworkConditionMatched" />
    </MSBuild>

    <ItemGroup Condition="'$(_IsTargetFrameworkConditionMatched)' == 'true'">
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="Enum.IsDefined&lt;TEnum&gt;"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="Environment.ProcessId"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="Environment.ProcessPath"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="StringSplitOptions.TrimEntries"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.Buffers" Include="SequenceReader.UnreadSequence"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.Collections.Generic" Include="IReadOnlySet"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.Runtime.CompilerServices" Include="IsExternalInit"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.Threading.Tasks" Include="ValueTask.CompletedTask"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.Threading.Tasks" Include="ValueTask.FromCanceled"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.Threading.Tasks" Include="ValueTask.FromResult"/>
    </ItemGroup>

    <!-- NET6_0_OR_GREATER -->
    <PropertyGroup>
      <_TargetFrameworkCondition>NET6_0_OR_GREATER</_TargetFrameworkCondition>
    </PropertyGroup>

    <MSBuild Properties="Set=$(DefineConstants);OtherSet=$(_TargetFrameworkCondition)" Projects="$(MSBuildThisFileFullPath)" Targets="TestSetOverlapsWith" >
      <Output TaskParameter="TargetOutputs" PropertyName="_IsTargetFrameworkConditionMatched" />
    </MSBuild>

    <ItemGroup Condition="'$(_IsTargetFrameworkConditionMatched)' == 'true'">
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="ISpanFormattable"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="HashCode.AddBytes"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="Math.DivRem_return:ValueTuple`2"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="String.Create(IFormatProvider)"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="Uri.UriSchemeSsh"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System" Include="Uri.UriSchemeTelnet"/>
      <_NETSdkAvailableApi TargetFrameworkCondition="$(_TargetFrameworkCondition)" Namespace="System.Numerics" Include="BitOperations.IsPow2"/>
    </ItemGroup>

    <ItemGroup>
      <_NETSdkAvailableApiSymbol Include="@(_NETSdkAvailableApi)">
        <TargetApiFullName Condition="'%(Identity)' == '*'">%(Namespace)</TargetApiFullName>
        <TargetApiFullName Condition="'%(Identity)' != '*'">%(Namespace).%(Identity)</TargetApiFullName>
        <Constant>$(
          [System.String]::new('%(_NETSdkAvailableApiSymbol.TargetApiFullName)')
          .Replace('.', '_')
          .Replace('(', '_')
          .Replace(')', '')
          .Replace('&lt;', '_OF_')
          .Replace('&gt;', '')
          .Replace(':', '_')
          .Replace('`', '_')
          .ToUpperInvariant()
        )</Constant>
      </_NETSdkAvailableApiSymbol>
    </ItemGroup>

    <ItemGroup>
      <NETSdkAvailableApiSymbol
        Condition="0 &lt; @(_NETSdkAvailableApiSymbol->Count())"
        Include="@(_NETSdkAvailableApiSymbol->Metadata('Constant'))"
        TargetApiFullName="%(_NETSdkAvailableApiSymbol.TargetApiFullName)"
      />
    </ItemGroup>
  </Target>

  <!-- returns value that represents whether the $(Set) overlaps with $(OtherSet) or not -->
  <Target Name="TestSetOverlapsWith" Returns="$(OtherSetHasElementWhichIncludedInSet)">
    <ItemGroup>
      <OtherSetElement Remove="@(OtherSetElement)" />
      <OtherSetElement Include="$(OtherSet)" />
      <OtherSetElement Update="@(OtherSetElement)">
        <IsIncludedInSet>$([System.Text.RegularExpressions.Regex]::IsMatch('$(Set)', '\b%(Identity)\b'))</IsIncludedInSet>
      </OtherSetElement>
    </ItemGroup>

    <Message Text="'$(Set)' contains element '%(OtherSetElement.Identity)' = %(OtherSetElement.IsIncludedInSet)" Importance="low" />

    <PropertyGroup>
      <OtherSetElementsInclusivities>@(OtherSetElement->Metadata('IsIncludedInSet'), ';')</OtherSetElementsInclusivities>
      <OtherSetHasElementWhichIncludedInSet>false</OtherSetHasElementWhichIncludedInSet>
      <OtherSetHasElementWhichIncludedInSet Condition="$([System.String]::new('$(OtherSetElementsInclusivities)').Contains('True'))">true</OtherSetHasElementWhichIncludedInSet>
    </PropertyGroup>

    <Message Text="inclusivities of other set elements: $(OtherSetElementsInclusivities)" Importance="low" />
    <Message Text="'$(Set)' overlaps with '$(OtherSet)' = $(OtherSetHasElementWhichIncludedInSet)" Importance="normal" />
  </Target>
</Project>
