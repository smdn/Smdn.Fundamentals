<!--
SPDX-FileCopyrightText: 2021 smdn <smdn@smdn.jp>
SPDX-License-Identifier: MIT
-->
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFrameworks>net6.0;net5.0;net461;net45;netstandard2.1;netstandard2.0;netstandard1.6</TargetFrameworks>
    <VersionPrefix>3.0.3</VersionPrefix>
    <VersionSuffix></VersionSuffix>
    <PackageValidationBaselineVersion>3.0.0</PackageValidationBaselineVersion>
  </PropertyGroup>

  <PropertyGroup Label="assembly attributes">
    <CopyrightYear>2021</CopyrightYear>
  </PropertyGroup>

  <PropertyGroup Label="package properties">
    <PackageTags>UUID;UUIDv1;UUIDv3;UUIDv4;UUIDv5;GUID;RFC4122</PackageTags>
  </PropertyGroup>

  <ItemGroup>
    <ProjectReference VersionRange="[3.0.2,4.0.0)" Include="..\Smdn.Fundamental.Exception\Smdn.Fundamental.Exception.csproj" />
    <PackageReference Include="System.Memory" Version="4.5.4" Condition="$(TargetFramework.StartsWith('net4')) or $(TargetFramework.StartsWith('netstandard1')) or $(TargetFramework.StartsWith('netstandard2.0'))" />
    <PackageReference Include="System.Runtime.CompilerServices.Unsafe" Version="6.0.0" Condition="($(TargetFramework.StartsWith('net46')) and '$(TargetFramework)' != 'net46') or $(TargetFramework.StartsWith('netstandard2'))" />
    <PackageReference Include="System.ValueTuple" Version="4.5.0" Condition="$(TargetFramework.StartsWith('net45')) or $(TargetFramework.StartsWith('net46')) or $(TargetFramework.StartsWith('netstandard1'))" />
    <PackageReference Include="Microsoft.Bcl.HashCode" Version="1.1.1" Condition="($(TargetFramework.StartsWith('net46')) and '$(TargetFramework)' != 'net46') or $(TargetFramework.StartsWith('netstandard2.0'))" />
  </ItemGroup>

  <PropertyGroup Condition="$([MSBuild]::VersionGreaterThanOrEquals('$(NETCoreSdkVersion)', '7.0.0'))">
    <TargetFrameworks>net7.0;$(TargetFrameworks)</TargetFrameworks>
    <DefineConstants Condition="$(TargetFramework.StartsWith('net7'))">FEATURE_GENERIC_MATH;$(DefineConstants)</DefineConstants>
    <EnablePreviewFeatures Condition="$(TargetFramework.StartsWith('net7'))">true</EnablePreviewFeatures>
  </PropertyGroup>

  <ItemGroup Condition="$([MSBuild]::VersionGreaterThanOrEquals('$(NETCoreSdkVersion)', '7.0.0'))">
    <PackageReference Include="System.Runtime.Experimental" Version="7.0.0-preview.2.22152.2" Condition="$(TargetFramework.StartsWith('net7'))" />
  </ItemGroup>

  <Target Name="AddExtraDefineConstants" AfterTargets="AddNETSdkApiDefineConstants">
    <PropertyGroup>
      <DefineConstants Condition="
        $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNET461_OR_GREATER\b')) Or
        $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNETSTANDARD2_1_OR_GREATER\b')) Or
        $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNETCOREAPP2_1_OR_GREATER\b')) Or
        $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNET5_0_OR_GREATER\b'))
      ">$(DefineConstants);SYSTEM_HASHCODE</DefineConstants>
      <DefineConstants Condition="
        $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNETSTANDARD2_1_OR_GREATER\b')) Or
        $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNETCOREAPP2_1_OR_GREATER\b')) Or
        $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNET5_0_OR_GREATER\b'))
      ">$(DefineConstants);SYSTEM_RUNTIME_INTEROPSERVICES_MEMORYMARSHAL_CREATEREADONLYSPAN</DefineConstants>
      <DefineConstants Condition="
        $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNET461_OR_GREATER\b')) Or
        $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNETSTANDARD2_1_OR_GREATER\b')) Or
        $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNETCOREAPP2_0_OR_GREATER\b')) Or
        $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bNET5_0_OR_GREATER\b'))
      ">$(DefineConstants);SYSTEM_RUNTIME_COMPILERSERVICES_UNSAFE_ASREF</DefineConstants>
      <DefineConstants Condition="
        $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bSYSTEM_RUNTIME_INTEROPSERVICES_MEMORYMARSHAL_CREATEREADONLYSPAN\b')) And
        $([System.Text.RegularExpressions.Regex]::IsMatch('$(DefineConstants)', '\bSYSTEM_RUNTIME_COMPILERSERVICES_UNSAFE_ASREF\b'))
      ">$(DefineConstants);NODE_READONLYSPAN</DefineConstants>
    </PropertyGroup>
  </Target>
</Project>
